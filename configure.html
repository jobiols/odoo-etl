
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notes Tab &#8212; Odoo ETL 12.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="&lt;no title&gt;" href="install.html" />
    <link rel="prev" title="Description" href="description.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>After installing ETL module, navigate to ETL’s manager model and create a new
manager with the following details:</p>
<ul>
<li><p><strong>Name</strong> contains the name of your manager without any specific restriction for the name.</p></li>
<li><p><strong>Target ID Type</strong> is a selection field where you can choose <em>Source ID</em>
or <em>Builded ID</em>. When set to <em>Source ID</em>, the record XML ID that will be used
in the migration process will be according to the default source exported
external ID. On the other hand, when set to <em>Builded ID</em>, the record XML ID
that will be used in the migration process will be customized according to
the prefix set later at an additional field.</p>
<p><strong>Source ID is recommended when performing a migration process.</strong></p>
</li>
<li><p><strong>Source Hostname</strong> the source database host URL that is used
to access the Odoo database from remote OS. i.e.: <a class="reference external" href="http://192.168.1.101">http://192.168.1.101</a>.
NOTE: For some unknown reason for me, the connection must be done with the
ip address. Trying with the URL does not work. Maybe a nginx problem…</p></li>
<li><p><strong>Source Port</strong> the source database port that is used to access
the Odoo database. i.e.: 80.</p></li>
<li><p><strong>Source Database</strong> The source database name.</p></li>
<li><p><strong>Source Login</strong> the username used to login to the source database from the
login page. Make sure this user have full access to all the models.</p></li>
<li><p><strong>Source Password</strong> the password, what else?.</p></li>
<li><p><strong>Source Language</strong> the source database default language. It’s recommended
to keep the language as default (en_US).</p></li>
<li><p><strong>Odoo Source Version</strong> The source odoo major version. Default is 8.</p>
<p>NOTE: This module was NOT Tested with source versions earlier than 8</p>
</li>
<li><p><strong>Target Hostname</strong> the target database host URL that is used to access the
Odoo database from remote OS. i.e.: <a class="reference external" href="http://192.168.1.101">http://192.168.1.101</a>.</p></li>
<li><p><strong>Target Port</strong> the target database port that is used to access the Odoo
database. i.e.: 8069.</p></li>
<li><p><strong>Target Database</strong> the target database name.</p></li>
<li><p><strong>Target Login</strong> the username used to login to the target database from the
login page. Make sure this user have full access to all the models.</p></li>
<li><p><strong>Target Password</strong> the password to access target system.</p></li>
<li><p><strong>Target Language</strong> the target database default language. It’s recommended
to keep the language as default (en_US).</p></li>
<li><dl class="simple">
<dt><strong>Odoo Target Version</strong> the target odoo major version, default is the odoo</dt><dd><p>version where this module is installed</p>
</dd>
</dl>
<p>NOTE: You can install this module in
a odoo instance that is neither the source nor the target. In this case please
be sure to change the Target Version for the target’s odoo major version.</p>
</li>
<li><p><strong>Models to delete Workflows</strong></p></li>
</ul>
<div class="section" id="notes-tab">
<h1>Notes Tab<a class="headerlink" href="#notes-tab" title="Permalink to this headline">¶</a></h1>
<p>If you started from a fresh target system you can define the modules to install
in the <strong>Notes</strong> tab filling a python list of modules. You should use the
technical names. With the button <strong>Install Modules</strong> you can install it and
test target system connectivity. Besides you can write down some notes about
the migration in the notepad field.</p>
</div>
<div class="section" id="checking-source-and-target-connectivity">
<h1>Checking Source and Target connectivity<a class="headerlink" href="#checking-source-and-target-connectivity" title="Permalink to this headline">¶</a></h1>
<p>After filling all the Manager form data you can test connection to the source
and target system with the button <strong>Read models</strong>, Then all the models from both
system will be read (be sure to set suitable timeouts in the odoo.conf)
You can see the models read in the <strong>External models</strong> tab.</p>
</div>
<div class="section" id="read-databases">
<h1>Read Databases<a class="headerlink" href="#read-databases" title="Permalink to this headline">¶</a></h1>
<p>To read the models and get the record counts from the source and the target
database click <strong>READ AND GET RECORDS</strong> from the action bar.
The following two buttons make both actions individually so to speak, pressing
<strong>READ MODELS</strong> and then <strong>GET RECORD NUMBERS</strong> is the same to press
<strong>READ AND GET RECORDS</strong></p>
<p>The ETL module will now attempt to connect and read from the source and
destination databases.</p>
<p>After the process is done, the <strong>External Models</strong> tab from your manager form
view should contain the list of models that have been read from the source and
target database (along with its fields when clicked) and record counts.</p>
</div>
<div class="section" id="mapping-source-and-target-models">
<h1>Mapping source and target models<a class="headerlink" href="#mapping-source-and-target-models" title="Permalink to this headline">¶</a></h1>
<p>Matching the source and target models along with its fields can be done
automatically by ETL; however, the result may not be perfectly correct if you
are moving data from different odoo versions.</p>
<p>Some models and fields change between odoo versions, in this case you may have
to manually adjust the migration, this is explained in the next section.
To perform an automatic mapping of models and fields, just click
<strong>Match and Order</strong> in the action bar.</p>
<p>After the process is done, the Actions tab from your manager form view should
contain the list of actions (model mappings) that have been matched and
ordered by ETL.
The models that etl could not match are flagged <strong>To Analyze</strong> the ones that
cout match are flagged <strong>Enabled</strong></p>
<p>After the actions have been generated, matched or not, it is necessary to order
them since there are dependencies, some models depend on others and things
must be executed in order. Just press <strong>ORDER ACTIONS</strong></p>
</div>
<div class="section" id="testing-actions-the-hard-work-begins">
<h1>Testing Actions (The hard work begins)<a class="headerlink" href="#testing-actions-the-hard-work-begins" title="Permalink to this headline">¶</a></h1>
<p>At the first use of the ETL manager, it’s necessary to test the actions one by
one which also means the migration will happen model by model for the first
time. An action represents a migration for a single model at a time. Actions
can also be understood as model mapping. It’s not necessary to configure all
the actions/model mapping implied by the Match and Order action, but only the
required actions/model mapping necessary for the intended migration.</p>
<p>To be able to configure the actions and test it, simply click it from the list
of actions in the manager.</p>
<p>Following are the details about the fields in the action model:</p>
<ul class="simple">
<li><p><strong>Name</strong> the name of the action which is usually filled automatically for
the <strong>Match and Order</strong> previous action.</p></li>
<li><p><strong>Source Domain</strong> used to apply domain for the source database model
when performing the migration to filter out or include certain records in the
migration.</p></li>
<li><p><strong>Blocked</strong> used to block the actions from running instead of having
to switch the status to disabled. This field is used when configuring and
testing the action on the first run of migration. After done configuring the
action, Blocked field will usually be checked then later unchecked when
performing the real migration which will be explained in the next section.</p></li>
<li><p><strong>Sequence</strong> used to set te execution order or the actions. The order in
which actions (representing models) will be performed is really important
due to the dependencies between models. i.e. The sequence of customer tags
model should be lower than the customer model since customer
model’s migration will require the existing records of tags when the
field tag_ids is enabled (configuration field will be explained in the next
section). When actions are in list view it can be reordeed with drag and drop.</p></li>
<li><p><strong>Repeating Action</strong> is a read-only field which will be automatically
checked when one of the fields states in the action’s Field Mapping list
is set to on_repeating. When this field is checked, the Run Repeated Action
button will appear in the action bar of the Actions model form.</p></li>
<li><p><strong>From Record</strong> is also used to filter out or include records in the
migration process. The ID records that will be migrated will start from the
value set at this field. To disable this feature, simply leave it along with
the To Record field to its default value 0 (zero).</p></li>
<li><p><strong>To Record</strong> is also used to filter out or include records in the migration
process. The records that will be migrated will end at the value set at this
field. To disable this feature, simply leave it along with the From Record
field to its default value 0 (zero).</p></li>
<li><p><strong>Source Model</strong> the source model to migrate. The <strong>Match and Order</strong>
action will try to fill this field.</p></li>
<li><p><strong>source_id_exp</strong> field name of the ID field in the source model.
Usually set at its default (id).</p></li>
<li><p><strong>Source Records</strong> read only field counting the number of records at the
source database in relation to the selected source model. The number of
non-active records will not be counted, but can still be included in migration
by setting the domain [‘|’, (‘active’, ‘=’, True), (‘active’, ‘=’, False)]</p></li>
<li><p><strong>Target Model</strong> the target model name which will be mapped to receive the
records from the source model when running the action.</p></li>
<li><p><strong>Target ID Type</strong> have the same function as the manager model‘s
<em>Target ID Type</em>. The default value will follow the value set at the manager
model‘s Target ID Type and can be changed in every action according to
preference (not recommended).</p></li>
<li><p><strong>Target Records</strong> read only field counting the number of records at the
target database in relation to the selected target model. The number
of the non-active records will not be counted.</p></li>
<li><p><strong>target_id_prefix</strong> field will only appear when the Target ID Type field is
set to Builded ID allowing the customization of the records XML id instead of
using the default export external ID.</p></li>
</ul>
<p>The <em>Action</em> fields are usually set correctly by the automatic <strong>Match and Order</strong>
action. Beside configuring the fields, it’s very important to set the action’s
state which can be changed to the following possible states:</p>
<ul class="simple">
<li><p><strong>Enabled</strong> The action will be included in the migration process.</p></li>
<li><p><strong>To Analyse</strong> The action requires further analysis and testing. and will
not be included in the migration process.</p></li>
<li><p><strong>Disabled</strong> The action will not be included in the migration process.</p></li>
<li><p><strong>No Records</strong> The action will not be included in the migration process due
to 0 records found in the source model.</p></li>
</ul>
<p>After correctly configuring and checking the <em>Action</em> fields, it’s very
important to also check and configure every line of field mapping in the field
mapping list in every actions. The field mapping determines which field of the
selected model to be included or excluded in the migration process.
To configure the fields, simply click the field mapping from the field
mapping list of the action form.</p>
<p>Following is the details about the default fields in the field mapping model:</p>
<ul class="simple">
<li><p><strong>Blocked</strong> works in a similar way with the Blocked field of the action model
which in this case is used to block fields that have been analysed so that
the data of this field is not included when running the testing.</p></li>
<li><p><strong>Source Type</strong> is a selection field which is set to the default value field
for standard field data migration. Other source types will be explained in
the next section.</p></li>
<li><p><strong>Source Field</strong> is the selection of source field names in respect to the
selected source model in the action model form.</p></li>
<li><p><strong>Source Exp.</strong> is a short description of the selected source field.</p></li>
<li><p><strong>Target Field</strong> is the selection of target field names in respect to the
selected target model in the action model form.</p></li>
<li><p><strong>Target Exp.</strong> is a short description of the selected target field.</p></li>
<li><p><strong>Notes</strong> is a field prepared for ETL users to write a longer notes for
each field mapping.</p></li>
</ul>
<p>Field mapping also have a state similar to that of actions and it’s also very
important to set the field mapping’s state which can be changed to the
following possible state:</p>
<ul class="simple">
<li><p><strong>Enabled</strong> should be set to a field mapping that will be included in the
action testing process and or migration process.</p></li>
<li><p><strong>To Analyse</strong> should be set to a field mapping that require a further
analysis and testing. When a field mapping is set to this state, it will not
be included when running the action testing process and or migration process.</p></li>
<li><p><strong>Disabled</strong> should be set to a field mapping that will not be included in
the action testing process and or migration process.</p></li>
<li><p><strong>Other Class</strong> should be set to a field mapping that involves a relational
field in which the record will be migrated from the other model.</p></li>
<li><p><strong>On Repeating</strong> should be set to a field mapping that usually involves a
relational field that requires its own records such as parent/child relation
or records from other models having a higher action sequence. This
field data will be migrated after the first migration iteration by clicking
<strong>Run Repeated Action</strong> in terms of action testing or <strong>Run Repeated Actions</strong>
while running migration from the manager later after completing the action
testing.</p></li>
</ul>
<p>After configuring all the field mapping and the configuration for a specific
action, test the action by clicking the <strong>Run Action</strong> button at the action
bar for that specific action.</p>
<p>To see the result of the test, check the value of <strong>Target Records</strong>. If it
increases after the process in regards to the <strong>Source Records</strong>, then the
migration can be considered to be successful. To further confirm and check
for errors, click the Log tab of the Actions form. When the test is
successful, the logs will show an array of new created database id for the
migrated records; otherwise, error messages will be shown. Address the error
by reconfiguring the setting and field mappings of that specific
action then re-run the test.</p>
</div>
<div class="section" id="cleaning-the-target-and-etl-database">
<h1>Cleaning the Target and ETL Database<a class="headerlink" href="#cleaning-the-target-and-etl-database" title="Permalink to this headline">¶</a></h1>
<p>After correctly configuring and testing all the actions/model mapping, disable
the other actions that will not be necessary for the intended migration and
unblock all the actions. Before proceeding, do not forget to backup your ETL
database.</p>
<p>Since the target database have been used for the testing, it’s recommended to
drop the database and recreate it. Make sure the modules are also installed
again. If the target database name is changed, don’t forget to change the
Target Database at the ETL manager.</p>
</div>
<div class="section" id="perform-migration">
<h1>Perform Migration<a class="headerlink" href="#perform-migration" title="Permalink to this headline">¶</a></h1>
<p>To perform the migration, simply click <strong>Run Actions</strong> button at the action bar
of the manager form view. This will run all the actions according to our
configuration in order. When process is completed, try checking for errors at
every action’s log since errors may still happen due to little misconfiguration.</p>
<p>When errors are found, try to address the errors accordingly by reconfiguring
the fields then re-run the migration.</p>
<p>When no errors are found, click <strong>Run Repeated Actions</strong> button at the action
bar of the manager form view as well to migrate the field mappings where state
is set to On Repeating.</p>
<p>Re-check for error at the action logs and try to address them if there is one
or more. After addressing the error, re-run the <strong>Run Repeated Actions</strong> action.</p>
<p>When no errors are found, migration can be considered to be successful.</p>
</div>
<div class="section" id="manually-mapping">
<h1>Manually Mapping<a class="headerlink" href="#manually-mapping" title="Permalink to this headline">¶</a></h1>
<p>Manual mapping for both models and fields are possible when the automatic
<strong>Match and Order</strong> action is inaccurate.</p>
<p>To manually map a model, navigate to the actions list view and create a new
action/model mapping. Select the manager in the <strong>Manager</strong> field of the action
then enter the detail of the action fields accordingly as described in Step 10
of the migration process. If the Source Model and the Target Model selection is
empty, make sure the Manager field is set to the correct manager that have
perform the <strong>Read and Get Records</strong> action.</p>
<p>After creating the action, click <strong>Add an item</strong> at the <strong>Field Mapping</strong> tab
of that specific action to create the field mapping. Enter the detail of the
field mapping fields accordingly as described in Step 10 of the migration
process.</p>
</div>
<div class="section" id="error-handling-for-selection-fields-and-value-mapping">
<h1>Error Handling for Selection Fields and Value Mapping<a class="headerlink" href="#error-handling-for-selection-fields-and-value-mapping" title="Permalink to this headline">¶</a></h1>
<p>Selection fields may cause confusing errors during migration since the source
field valid selection values may be different with the target field valid
selection values.</p>
<p>For example, in OpenERP version 7.0, the <strong>priority</strong> field of the project.task
model have the following selection range: “Very Low”, “Low”, “Medium”,
“Important”, “Very Important”. In Odoo version 9.0, however, the selection
range of the same field allows a different selection range such as following:
“Normal”, “High”.</p>
<p>In this case, we need to utilize ETL’s Value Mapping Fields.</p>
<blockquote>
<div><p>Source Field –&gt; Value Mapping –&gt; Target Field</p>
</div></blockquote>
</div>
<div class="section" id="value-mapping-fields">
<h1>Value Mapping Fields<a class="headerlink" href="#value-mapping-fields" title="Permalink to this headline">¶</a></h1>
<p>To use value mapping fields, navigate to the value mapping fields list view
and click create. Set a name to the value mapping field at the <strong>Field Name</strong>
field then set the type value to <strong>Selection</strong>. Set the <strong>manager_id</strong> field
value to the specific manager that will be used for the migration.</p>
<p>For every possible selection values (both at source and at destination),
create a <strong>Mapping Value</strong> record by clicking <strong>Add an item</strong> at the
<strong>Mapping Values</strong> list. <strong>Key</strong> should be the real selection value and
<strong>Help Name</strong> can be a short description for that specific selection value or
simply the same value with <strong>Key</strong>.</p>
<p>For example, the <strong>Mapping Values</strong> for the <strong>project.task priority</strong> field
will be as following:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Help Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Very Important</p></td>
<td><p>Very Important</p></td>
</tr>
<tr class="row-odd"><td><p>Important</p></td>
<td><p>Important</p></td>
</tr>
<tr class="row-even"><td><p>Medium</p></td>
<td><p>Medium</p></td>
</tr>
<tr class="row-odd"><td><p>Low</p></td>
<td><p>Low</p></td>
</tr>
<tr class="row-even"><td><p>Very Low</p></td>
<td><p>Very Low</p></td>
</tr>
<tr class="row-odd"><td><p>Normal</p></td>
<td><p>Normal</p></td>
</tr>
<tr class="row-even"><td><p>High</p></td>
<td><p>High</p></td>
</tr>
</tbody>
</table>
<p>After setting the Mapping Values, do not directly do the Details list. Click save, then edit to
continue entering the Details list. The value mapping will be done in the Details list
according to the Source Value and Target Value.</p>
<p>For example, the Details for the project.task priority field will be as following:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Source Value</p></th>
<th class="head"><p>Target Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Very Low</p></td>
<td><p>Normal</p></td>
</tr>
<tr class="row-odd"><td><p>Low</p></td>
<td><p>Normal</p></td>
</tr>
<tr class="row-even"><td><p>Medium</p></td>
<td><p>Normal</p></td>
</tr>
<tr class="row-odd"><td><p>Important</p></td>
<td><p>High</p></td>
</tr>
<tr class="row-even"><td><p>Very Important</p></td>
<td><p>High</p></td>
</tr>
</tbody>
</table>
<p>Click <strong>Save</strong> to save the <strong>Value Mapping Fields</strong> record.
When the Value Mapping Field for a specific selection field is have been
created, navigate to the action containing that specific field mapping, click
the intended field mapping, then set the <strong>Source Type</strong> field to <strong>Value
Mapping</strong> and set the <strong>Value Mapping Field</strong> to the specific value mapping
field record that have been created. Save the changes that have been made.</p>
<p>The value mapping example for the <strong>project.task priority</strong> selection field is
shown according to the following image:</p>
<p>image</p>
</div>
<div class="section" id="python-expression">
<h1>Python Expression<a class="headerlink" href="#python-expression" title="Permalink to this headline">¶</a></h1>
<p>Some field mappings may be enhanced with python code to allow more dynamic
values at the target field. To utilize expressions field mapping, navigate to
the field mapping that will the require the expression then changing the
<strong>Source Type</strong> into <strong>expression</strong>. After setting the type into expression, an
additional field expression will appear. The python expression will be coded
inside this field.</p>
<blockquote>
<div><p>Source Field –&gt; Expression –&gt; Target Field</p>
</div></blockquote>
<p>Following python code from <strong>field_mapping.py</strong> located inside the ETL addons
directory shows possible objects that can be accessed from the expressions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">multi</span>
<span class="k">def</span> <span class="nf">run_expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec_id</span><span class="p">,</span> <span class="n">source_connection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">target_connection</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field_mapping</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">expression_result</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_connection</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">target_connection</span><span class="p">:</span>
            <span class="p">(</span><span class="n">source_connection</span><span class="p">,</span> <span class="n">target_connection</span><span class="p">)</span> <span class="o">=</span> <span class="n">field_mapping</span><span class="o">.</span><span class="n">action_id</span><span class="o">.</span><span class="n">manager_id</span><span class="o">.</span><span class="n">open_connections</span><span class="p">()</span>
        <span class="n">source_model_obj</span> <span class="o">=</span> <span class="n">source_connection</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">field_mapping</span><span class="o">.</span><span class="n">action_id</span><span class="o">.</span><span class="n">source_model_id</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="n">target_model_obj</span> <span class="o">=</span> <span class="n">target_connection</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">field_mapping</span><span class="o">.</span><span class="n">action_id</span><span class="o">.</span><span class="n">target_model_id</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="n">obj_pool</span> <span class="o">=</span> <span class="n">source_model_obj</span>
        <span class="n">cxt</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;self&#39;</span><span class="p">:</span> <span class="n">obj_pool</span><span class="p">,</span> <span class="c1">#to be replaced by target_obj</span>
                <span class="s1">&#39;source_obj&#39;</span><span class="p">:</span> <span class="n">source_model_obj</span><span class="p">,</span>
                <span class="s1">&#39;source_connection&#39;</span><span class="p">:</span> <span class="n">source_connection</span><span class="p">,</span>
                <span class="s1">&#39;target_obj&#39;</span><span class="p">:</span> <span class="n">target_model_obj</span><span class="p">,</span>
                <span class="s1">&#39;target_connection&#39;</span><span class="p">:</span> <span class="n">target_connection</span><span class="p">,</span>
                <span class="s1">&#39;rec_id&#39;</span><span class="p">:</span> <span class="n">rec_id</span><span class="p">,</span>
                <span class="s1">&#39;pool&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">,</span>
                <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span>
                <span class="s1">&#39;cr&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cr</span><span class="p">,</span>
                <span class="c1"># copy context to prevent side-effects of eval</span>
                <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="p">),</span>
                <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">field_mapping</span><span class="o">.</span><span class="n">expression</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Warning. Type expression choosen buy not expression set&#39;</span><span class="p">))</span>
        <span class="c1"># nocopy allows to return &#39;action&#39;</span>
        <span class="nb">eval</span><span class="p">(</span><span class="n">field_mapping</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">cxt</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;exec&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;result&#39;</span> <span class="ow">in</span> <span class="n">cxt</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">]:</span>
            <span class="n">expression_result</span> <span class="o">=</span> <span class="n">cxt</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expression_result</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>For further details, please open field_mapping.py at the addons folder of the
ETL module.</p>
</div>
<div class="section" id="error-handling-for-relational-field-using-raw-integer-as-id">
<h1>Error Handling for Relational Field Using Raw Integer as ID<a class="headerlink" href="#error-handling-for-relational-field-using-raw-integer-as-id" title="Permalink to this headline">¶</a></h1>
<p>Some models such as <strong>mail.followers</strong> has a field such as res_id that stores
the ID of the resource/record it attached to in a raw integer type (int)
instead of relational type (many2one / one2many / many2many). Hence, when it’s
migrated, there will be no technical error but the res_id remains the resource
ID of the source database which may change in the destination database. This
error can be solved by using python expressions in the field mapping.
Following is the python expressions used to solve this issue related to the
<strong>mail.followers res_id</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source_ip</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_connection</span><span class="o">.</span><span class="n">_server</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;://&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">destination_ip</span> <span class="o">=</span>
<span class="nb">str</span><span class="p">(</span><span class="n">target_connection</span><span class="o">.</span><span class="n">_server</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;://&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">source_db</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_connection</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">destination_db</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_connection</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT destination.res_id as destination_res_id FROM</span>
<span class="s2">dblink(&#39;dbname=&#39;</span><span class="si">%s</span><span class="s2">&#39; port=5432 host=&#39;</span><span class="si">%s</span><span class="s2">&#39; user=leonardo</span>
<span class="s2">password=123&#39;,&#39;select a.id, a.res_model, a.res_id, b.name from</span>
<span class="s2">mail_followers a left join ir_model_data b on a.res_model = b.model and</span>
<span class="s2">a.res_id = b.res_id&#39;) AS source(id integer, res_model varchar, res_id</span>
<span class="s2">integer, name varchar), dblink(&#39;dbname=&#39;</span><span class="si">%s</span><span class="s2">&#39; port=5432 host=&#39;</span><span class="si">%s</span><span class="s2">&#39;</span>
<span class="s2">user=postgres password=123&#39;,&#39;select res_id, name from ir_model_data&#39;) AS</span>
<span class="s2">destination(res_id integer, name varchar) WHERE source.res_model in</span>
<span class="s2">(SELECT * FROM dblink(&#39;dbname=&#39;</span><span class="si">%s</span><span class="s2">&#39; port=5432 host=&#39;</span><span class="si">%s</span><span class="s2">&#39; user=postgres</span>
<span class="s2">password=123&#39;,&#39;select model from ir_model&#39;) AS model(model varchar)) AND</span>
<span class="s2">source.name = destination.name AND source.id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,(</span><span class="n">source_db</span><span class="p">,</span>
<span class="n">source_ip</span><span class="p">,</span> <span class="n">destination_db</span><span class="p">,</span> <span class="n">destination_ip</span><span class="p">,</span> <span class="n">destination_db</span><span class="p">,</span> <span class="n">destination_ip</span><span class="p">,</span>
<span class="n">rec_id</span><span class="p">,))</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Do note that the above python code uses the <strong>dblink</strong> extension function from
Postgres which require details such as database port, user, and password.
In above case, source Postgres database have the following credential:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DB</span> <span class="n">User</span>     <span class="p">:</span> <span class="n">leonardo</span>
<span class="n">DB</span> <span class="n">Password</span> <span class="p">:</span> <span class="mi">123</span>
<span class="n">DB</span> <span class="n">Port</span>     <span class="p">:</span> <span class="mi">5432</span>
</pre></div>
</div>
<p>In above case, the destination Postgres database have the following credential:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DB</span> <span class="n">User</span>     <span class="p">:</span> <span class="n">postgres</span>
<span class="n">DB</span> <span class="n">Password</span> <span class="p">:</span> <span class="mi">123</span>
<span class="n">DB</span> <span class="n">Port</span>     <span class="p">:</span> <span class="mi">5432</span>
</pre></div>
</div>
<p>It is very crucial to execute the following SQL at the ETL’s PostgreSQL
database (not source or destination) before using the expressions containing
the dblink Postgres function:</p>
<p>CREATE EXTENSION dblink;</p>
</div>
<div class="section" id="error-handling-for-create-date-field">
<h1>Error Handling for Create Date Field<a class="headerlink" href="#error-handling-for-create-date-field" title="Permalink to this headline">¶</a></h1>
<p>ETL does not support the migration of the create and write date for all the
Odoo models. After running the migration, create and write date will be set to
the migration date. It is in fact that this create or write date field can be
ignored in some modules, but for some other modules it may be crucial. In that
case it’s necessary to manipulate the create and or write date with python
expressions to allow the accurate migration for create and or write date.
Following is the python expression used to solve the create date issue related
to the <strong>crm.lead</strong> model in which create date is crucial:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source_ip</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_connection</span><span class="o">.</span><span class="n">_server</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;://&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">destination_ip</span> <span class="o">=</span>
<span class="nb">str</span><span class="p">(</span><span class="n">target_connection</span><span class="o">.</span><span class="n">_server</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;://&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">source_db</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_connection</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">destination_db</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_connection</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT destination.id, source.create_date FROM</span>
<span class="s2">dblink(&#39;dbname=&#39;</span><span class="si">%s</span><span class="s2">&#39; port=5432 host=&#39;</span><span class="si">%s</span><span class="s2">&#39; user=leonardo</span>
<span class="s2">password=123&#39;,&#39;SELECT a.id, b.name, a.create_date FROM crm_lead a,</span>
<span class="s2">ir_model_data b WHERE a.id = b.res_id and b.model = &#39;&#39;crm.lead&#39;&#39;&#39;) AS</span>
<span class="s2">source(id integer, name varchar, create_date timestamp),</span>
<span class="s2">dblink(&#39;dbname=&#39;</span><span class="si">%s</span><span class="s2">&#39; port=5432 host=&#39;</span><span class="si">%s</span><span class="s2">&#39; user=postgres</span>
<span class="s2">password=123&#39;,&#39;SELECT a.id, b.name, a.create_date FROM crm_lead a,</span>
<span class="s2">ir_model_data b WHERE a.id = b.res_id and b.model = &#39;&#39;crm.lead&#39;&#39;&#39;) AS</span>
<span class="s2">destination(id integer, name varchar, create_date timestamp) WHERE</span>
<span class="s2">source.name = destination.name AND source.id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,(</span><span class="n">source_db</span><span class="p">,</span>
<span class="n">source_ip</span><span class="p">,</span> <span class="n">destination_db</span><span class="p">,</span> <span class="n">destination_ip</span><span class="p">,</span> <span class="n">rec_id</span><span class="p">,))</span>
<span class="n">matching_record</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dest_id</span> <span class="o">=</span> <span class="n">matching_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">create_date</span> <span class="o">=</span> <span class="n">matching_record</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT dblink_exec(&#39;dbname=&#39;</span><span class="si">%s</span><span class="s2">&#39; port=5432 host=&#39;</span><span class="si">%s</span><span class="s2">&#39;</span>
<span class="s2">user=postgres password=123&#39;,&#39;UPDATE crm_lead SET create_date = TIMESTAMP</span>
<span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE id = </span><span class="si">%s</span><span class="s2">&#39;)&quot;&quot;&quot;</span><span class="p">,(</span><span class="n">destination_db</span><span class="p">,</span> <span class="n">destination_ip</span><span class="p">,</span> <span class="n">create_date</span><span class="p">,</span>
<span class="n">dest_id</span><span class="p">))</span>
<span class="n">context</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">create_date</span><span class="p">)</span>
</pre></div>
</div>
<p>Do note that the above python code uses the dblink extension function from
Postgres which require details such as database port, user, and password.
In above case, source Postgres database have the following credential:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DB</span> <span class="n">User</span>     <span class="p">:</span> <span class="n">leonardo</span>
<span class="n">DB</span> <span class="n">Password</span> <span class="p">:</span> <span class="mi">123</span>
<span class="n">DB</span> <span class="n">Port</span>     <span class="p">:</span> <span class="mi">5432</span>
</pre></div>
</div>
<p>In above case, the destination Postgres database have the following credential:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DB</span> <span class="n">User</span>     <span class="p">:</span> <span class="n">postgres</span>
<span class="n">DB</span> <span class="n">Password</span> <span class="p">:</span> <span class="mi">123</span>
<span class="n">DB</span> <span class="n">Port</span>     <span class="p">:</span> <span class="mi">5432</span>
</pre></div>
</div>
<p>It is very crucial to execute the following SQL at the ETL’s PostgreSQL
database (not source or destination) before using the expressions containing
the dblink Postgres function:</p>
<p>CREATE EXTENSION dblink;</p>
</div>
<div class="section" id="error-handling-for-many-to-many-field-migration">
<h1>Error Handling for Many to Many Field Migration<a class="headerlink" href="#error-handling-for-many-to-many-field-migration" title="Permalink to this headline">¶</a></h1>
<p>The ETL module source code contains a bug related to the migration of many to
many field type. This can be solved by modifying the action.py python script
at line 471 located at the ETL addons folder.</p>
<p>Replace:</p>
<blockquote>
<div><p>new_field_value = value</p>
</div></blockquote>
<p>Into:</p>
<blockquote>
<div><dl class="simple">
<dt>if new_field_value:</dt><dd><p>new_field_value = new_field_value + ‘,’ + value</p>
</dd>
<dt>else:</dt><dd><p>new_field_value = value</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="more-about-etls-migration-method">
<h1>More about ETL’s Migration Method<a class="headerlink" href="#more-about-etls-migration-method" title="Permalink to this headline">¶</a></h1>
<p>As mentioned earlier, one of the advantages of ETL is that it uses the native
Odoo method. This can be found at the <strong>action.py python</strong> script at line
580 (unmodified action.py) located at the ETL addons folder.</p>
<p>ETL calls the load function of OpenERP to load the data into the target model.
The load function can be found at the models.py python script starting at line
1022 (unmodified models.py at Odoo version 9) located at the OpenERP directory
of Odoo.</p>
</div>
<div class="section" id="about-the-erppeek">
<h1>About the ERPpeek<a class="headerlink" href="#about-the-erppeek" title="Permalink to this headline">¶</a></h1>
<p>Every connection made from the ETL database to the source and target database
uses the methods from python library called ERPpeek in which ERPpeek itself
uses xmlrpc to communicate with the databases. The source and target
destination is called as a class object Client. Actions done at those databases
are also done using methods from ERPpeek.</p>
<blockquote>
<div><p>A &lt;–&gt; ERPpeek &lt;–&gt; ETL &lt;–&gt; ERPpeek</p>
</div></blockquote>
<p>The ERPpeek python code can be viewed at the following link:
<a class="reference external" href="https://github.com/tinyerp/erppeek/blob/master/erppeek.py">https://github.com/tinyerp/erppeek/blob/master/erppeek.py</a>.</p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Odoo ETL</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="description.html">Description</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Notes Tab</a></li>
<li class="toctree-l1"><a class="reference internal" href="#checking-source-and-target-connectivity">Checking Source and Target connectivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="#read-databases">Read Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="#mapping-source-and-target-models">Mapping source and target models</a></li>
<li class="toctree-l1"><a class="reference internal" href="#testing-actions-the-hard-work-begins">Testing Actions (The hard work begins)</a></li>
<li class="toctree-l1"><a class="reference internal" href="#cleaning-the-target-and-etl-database">Cleaning the Target and ETL Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="#perform-migration">Perform Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="#manually-mapping">Manually Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="#error-handling-for-selection-fields-and-value-mapping">Error Handling for Selection Fields and Value Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="#value-mapping-fields">Value Mapping Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="#python-expression">Python Expression</a></li>
<li class="toctree-l1"><a class="reference internal" href="#error-handling-for-relational-field-using-raw-integer-as-id">Error Handling for Relational Field Using Raw Integer as ID</a></li>
<li class="toctree-l1"><a class="reference internal" href="#error-handling-for-create-date-field">Error Handling for Create Date Field</a></li>
<li class="toctree-l1"><a class="reference internal" href="#error-handling-for-many-to-many-field-migration">Error Handling for Many to Many Field Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="#more-about-etls-migration-method">More about ETL’s Migration Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="#about-the-erppeek">About the ERPpeek</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">12.0.0.0.0 (2019-10-16)</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html#id3">9.0 (2015-??)</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html#id4">8.0 (2014-??)</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html#lost-in-time">7.0 (????-??-??) Lost in time</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">1- Crear un registro Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#leer-los-modelos">1- Leer los modelos</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="description.html" title="previous chapter">Description</a></li>
      <li>Next: <a href="install.html" title="next chapter">&lt;no title&gt;</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Jorge Obiols.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/configure.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>